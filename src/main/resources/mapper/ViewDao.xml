<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hhxy.shops.dao.ViewDao">

    <select id="selectCartViewByUid" resultType="java.util.HashMap">
        select *
        from CART_VIEW
        where uid = #{id}
    </select>
    <select id="selectDisCountByUserIdList" resultType="java.util.HashMap">
        select *
        from DISCOUNT_VIEW
        where uid = #{param1}
        limit #{param2}, #{param3}
    </select>
    <select id="selectSelfCount" resultType="java.util.HashMap">
        select SUM(prices) as prices, DATE_FORMAT( createTime, "%Y-%m-%d" ) as `time` from orders
        <where>
            <if test="userId != null">and id in (select oid from orders_sub where cid in (select id from commodity where
                sid = (select id from store where userid = #{userId})))
            </if>
        </where>
        group by DATE_FORMAT( createTime, "%Y-%m-%d" ) order by DATE_FORMAT( createTime, "%Y-%m-%d" ) asc
        limit 0,7
    </select>
    <select id="selectHotSelf" resultType="java.util.HashMap">
        SELECT a1.num, c.name from (select cid, SUM(num) num from orders_sub
        <where>
            <if test="userId != null">
                cid in (SELECT id from commodity WHERE sid in (SELECT id from store WHERE userid = #{userId}))
            </if>
        </where>
        GROUP by cid) as a1 LEFT JOIN
        commodity as c on a1.cid = c.id ORDER by num desc
        limit 0, 5
    </select>
</mapper>